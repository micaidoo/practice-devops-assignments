# Setting Up Maven and Tomcat on EC2 Instance for CI/CD, and implementig a simple maven generated web app project.

## PART I (Maven & Tomcat Server -2 in 1)

1. **Launch a new EC2 instance and name it CICD, with ssh access and port 8080 open in your inbound rules.**

2. **SSH into your instance**

3. **Change the hostname and switch to user ubuntu e.g.** 
```
sudo hostnamectl set-hostname cicd && sudo su - ubuntu

```

4. **Update your system e.g.** 
```
sudo apt-get upgrade -y && sudo apt-get update -y

```

5. **Install the default Java JDK e.g.** 
```
sudo apt-get install default-jdk -y

```

6. **Download Maven and Tomcat zipped files using ```wget```**
e.g. 
```
sudo wget https://dlcdn.apache.org/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz && sudo wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.85/bin/apache-tomcat-9.0.85.tar.gz

```

7. **Extract the zip files** 
e.g. 
```
sudo tar -xzvf apache-maven-3.9.6-bin.tar.gz && sudo tar -xzvf apache-tomcat-9.0.85.tar.gz

```

8. **Remove the zipped packages after extraction** 
e.g. 
```
sudo rm apache-maven-3.9.6-bin.tar.gz && sudo rm apache-tomcat-9.0.85.tar.gz

```

9. **Rename and move the extracted directories to the /opt directory**
e.g. 
```
sudo mv apache-maven-3.9.6/ /opt/maven && sudo mv apache-tomcat-9.0.85/ /opt/tomcat9

```

10. **Modify the environment variables by editing the .bashrc file**
e.g. sudo vi ~/.bashrc
```
export M2_HOME=/opt/maven/
export PATH=$PATH:$M2_HOME/bin
```

11. **Save and exit**

12. **Reload the .bashrc file** 
e.g. 
```
source ~/.bashrc

```

13. **Verify Maven is installed** 
e.g. 
```
mvn -version

```

14. **Enable all access to the Tomcat directory** 
e.g. 
```
sudo chmod 777 -R /opt/tomcat9

```

15. **Enable easy access to starting and stopping Tomcat by creating symbolic links**
e.g. 
```
sudo ln -s /opt/tomcat9/bin/startup.sh /usr/bin/starttomcat && sudo ln -s /opt/tomcat9/bin/shutdown.sh /usr/bin/stoptomcat

```

16. **Verify Tomcat is working**  
- Start Tomcat by calling the link you created earlier 
e.g. 
```
sudo starttomcat

```
- Visit `instance-ip-address:8080` from your browser

17. **Create a new directory called ```my-app``` in your home directory and move into it**

18. **Use Maven to generate a new web-app project**
e.g. 
```
mvn archetype:generate -DgroupId=com.example -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-webapp

```

- leave everyhting at deafult

19. **Verify the my-app directory has been generated by maven and cd into it.**

20. **Modify the contents of the `src/main/webapp/index.jsp file` and paste in the contents of [index.jsp](assignment_resources/index.jsp). Modify as you please**

21. **Clean and package your app by running ```mvn clean package``` in the root of your web app directory**
- notice the build success and also verify the creation of the web-app artifact inside the target directory.

22. **Copy the packaged WAR artifact in the target directory to the webapps directory of Tomcat9**
e.g. 
```
sudo cp target/my-app.war /opt/tomcat9/webapps/

```

23. **Stop and start tomcat by calling the links you created earlier** 
e.g. 
```
sudo stoptomcat
sudo starttomcat

```

24. **Modify Tomcat configurations to allow access to the manager app from any IP by editing the context.xml file**
e.g. 
```
sudo vi /opt/tomcat9/webapps/manager/META-INF/context.xml

```
-comment these 2 lines

```
- <Valve className="org.apache.catalina.valves.RemoteAddrValve" 

- allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" />

```

25. **Create a new Tomcat user and add roles to enable accessing the manager app**
e.g. 
```
sudo vi /opt/tomcat9/conf/tomcat-users.xml

```
- under the users section, add a new user with password and specify roles in similar manner as commented.

26. **Stop and start tomcat`**

27. **Open ```instance-ip-address:8080```, navigate to the manager app, login with the user you created, scroll down and notice your web-app, open it**

28. **Did it work?**




## PART II (Tomcat Server)


1. Launch another Ubuntu Ec2 instance with ssh access

2. SSH into your instance

4. **Update your system e.g.** 
```
sudo apt-get upgrade -y && sudo apt-get update -y

```

5. **Install the default Java JDK e.g.** 
```
sudo apt-get install default-jdk -y

```

6. **Download Tomcat zipped file using ```wget```**
e.g. 
```
sudo wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.85/bin/apache-tomcat-9.0.85.tar.gz

```

7. **Extract the zip files** 
e.g. 
```
sudo tar -xzvf apache-tomcat-9.0.85.tar.gz

```

8. **Remove the zipped packages after extraction** 
e.g. 
```
    sudo rm apache-tomcat-9.0.85.tar.gz

```

9. **Rename and move the extracted directories to the /opt directory**
e.g. 
```
sudo mv apache-tomcat-9.0.85/ /opt/tomcat9
   
```

10. **Enable all access to the Tomcat directory** 
e.g. 
```
sudo chmod 777 -R /opt/tomcat9

```

11. **Enable easy access to starting and stopping Tomcat by creating symbolic links in your /usr/bin directory**
e.g. 
```
sudo ln -s /opt/tomcat9/bin/startup.sh /usr/bin/starttomcat && sudo ln -s /opt/tomcat9/bin/shutdown.sh /usr/bin/stoptomcat

```

12. **Verify Tomcat is working**  
- Start Tomcat by calling the link you created earlier 
e.g. 
```
sudo starttomcat

```
- Visit ```instance-ip-address:8080``` from your browser

13.  **Click on the manager app, and follow the instruction to modify Tomcat configurations to allow access to the manager app from any IP by editing the `context.xml` file**
e.g. 
```
sudo vi /opt/tomcat9/webapps/manager/META-INF/context.xml

```
- comment these 2 lines
```
<Valve className="org.apache.catalina.valves.RemoteAddrValve"   
allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" />   

```

14. **Create a new Tomcat user and add roles to enable accessing the manager app**
e.g. 
```
sudo vi /opt/tomcat9/conf/tomcat-users.xml

```
- under the users section, add a new user with apssword and specify roles in similar manner as commented.

15. **On your CICD server, navigate to your web-app directory, and open the pom.xml file. Paste the contents of the [tomcat_plugin.xml](assignment_resources/tomcat_plugin.xml) file in the build code block.***

- change the values in the plugin as necesarry.

16. **Edit the contents of the settings.xml file in your maven home directory at ` ~/.m2/settings.xml ` and paste in the contents of this [dettings.xml](assignment_resources/settings.xml)**
- create the settings file if it doesn't exist
- modify as necessary.

17. **From the root of your web app directory, deploy the the web app to the remote tomcat server**
eg.
```
mvn tomcat7:deploy

```

18. **Visit `instance-ip-address:8080` (remote tomcat server) from your browser, click on the manager app and notice your web app. Click on your web app to open it.**

19. **Did it work?**


### HAPPY LEARNING.
